var Fns={},VN_Services={};VN_Services._Open_SocialFollow=!0,VN_Services._Open_SocialToggle=!0,VN_Services._Open_SocialDelete=!0;var VNS_Routine=function(e){if(!e)return!1;if("undefined"==typeof API)throw new Error("请接入API配置文件！")};!function(e){var t=e.ajax,r={},o=[],a=[],n=[];e.ajax=function(e){e=jQuery.extend(e,jQuery.extend({},jQuery.ajaxSettings,e));var l=e.port;switch(e.mode){case"abort":return r[l]&&r[l].abort(),r[l]=t.apply(this,arguments);case"queue":var s=e.complete;return e.complete=function(){s&&s.apply(this,arguments),jQuery([t]).queue("ajax"+l).length>0?jQuery([t]).dequeue("ajax"+l):n[l]=!1},jQuery([t]).queue("ajax"+l,function(){t(e)}),void(1!=jQuery([t]).queue("ajax"+l).length||n[l]||(n[l]=!0,jQuery([t]).dequeue("ajax"+l)));case"sync":var c=o.length;o[c]={error:e.error,success:e.success,complete:e.complete,done:!1},a[c]={error:[],success:[],complete:[]},e.error=function(){a[c].error=arguments},e.success=function(){a[c].success=arguments},e.complete=function(){if(a[c].complete=arguments,o[c].done=!0,0==c||!o[c-1])for(var e=c;e<o.length&&o[e].done;e++)o[e].error&&o[e].error.apply(jQuery,a[e].error),o[e].success&&o[e].success.apply(jQuery,a[e].success),o[e].complete&&o[e].complete.apply(jQuery,a[e].complete),o[e]=null,a[e]=null}}return t.apply(this,arguments)}}(jQuery),Fns.ajax={sync:function(e,t){var r={};return $.ajax({url:e,type:"POST",data:t,async:!1,time:5e3,success:function(e){r=e},error:function(){}}),r},async:function(e,t,r){var o={};"object"==typeof e?(o.url=e.url,o.params=e.params,o.callback=e.callback):(o.url=e,o.params=t,o.callback=r),$.ajax({url:o.url,type:"POST",dataType:"json",time:5e3,data:o.params,success:function(e){o.callback&&o.callback.success&&o.callback.success(e)},error:function(){o.callback&&o.callback.error&&o.callback.error()},error:function(){}})}},Fns.word={expandShrink:function(e){var t={Context_Obj:"",UI_Str_Suspension:"......",UI_Str_Padding:"14px",UI_Str_Expand:"展开",UI_Str_Shrink:"收起",UI_Num_WordLen:22};$.extend(t,e);var r={init:function(){var e=this;t.Context_Obj.html(e.wordLen(t.Context_Obj.html(),t.UI_Num_WordLen)).find(".FnsExpandShrink_Toggle").on("click",function(){$(this).html()===t.UI_Str_Expand?($(this).html(t.UI_Str_Shrink),$(".FnsExpandShrink_HideWord",this.parentNode).show(),$(".FnsExpandShrink_Dot",this.parentNode).hide()):($(this).html(t.UI_Str_Expand),$(".FnsExpandShrink_HideWord",this.parentNode).hide(),$(".FnsExpandShrink_Dot",this.parentNode).show())})},wordLen:function(e,r){for(var o=0,a="",n=0;n<e.length;n++){if(o+=e.charCodeAt(n)>128?2:1,o>r){a+='<span class="FnsExpandShrink_Dot">'+t.UI_Str_Suspension+'</span><span class="FnsExpandShrink_HideWord" style="display:none;">'+e.substr(n)+'</span><span class="FnsExpandShrink_Toggle" style="cursor:pointer;padding-left:'+t.UI_Str_Padding+';">'+t.UI_Str_Expand+"</span>";break}a+=e.substr(n,1)}return a}};r.init()},firstUpperCase:function(e){return e.substr(0,1).toUpperCase()+e.substr(1)},limitStrLen:function(e,t){for(var r=0,o="",a=0;a<e.length;a++)if(o+=e.charAt(a),e.charCodeAt(a)>128){if(r+=2,r>=t)return o.substring(0,o.length-1)+"..."}else if(r+=1,r>=t)return o.substring(0,o.length-2)+"...";return o}};var DYNAMIC_CALL="//www.allinmd.cn/call/",API={list:{myReview:{desc:"我的评论",url:DYNAMIC_CALL+"review/json_list/",params:{pageIndex:1,pageSize:20,sortType:7,attUseFlag:3,logoUseFlag:3,customerId:1403850301790,scene:2,reviewStatus:1,isValid:1}}},socialAction:{followCreate:{desc:"创建关注对人的 paramJson",url:DYNAMIC_CALL+"customer/follow_people/create/",params:{refId:0,dataFlag:2}},followCancel:{desc:"取消关注对人的 paramJson",url:DYNAMIC_CALL+"customer/follow_people/delete/",params:{refId:0,dataFlag:2}},followResourceCreate:{desc:"创建关注对资源的 paramJson",url:DYNAMIC_CALL+"customer/follow_resource/create/",params:{followType:0,refName:"",refId:0}},followResourceCancel:{desc:"取消关注对资源的 paramJson",url:DYNAMIC_CALL+"customer/follow_resource/delete/",params:{followType:0,refId:0}},preferCreate:{desc:"创建赞 paramJson",url:DYNAMIC_CALL+"prefer/create/",params:{dataFlag:2,refId:0,trendsId:0,refCustomerId:0,usefulType:0,upDownType:1}},preferCancel:{desc:"取消赞 paramJson",url:DYNAMIC_CALL+"prefer/delete/",params:{dataFlag:2,refId:0,trendsId:0,refCustomerId:0,usefulType:0,upDownType:0}},collectionCreate:{desc:"创建收藏 paramJson",url:DYNAMIC_CALL+"collection/create/",params:{dataFlag:2,refId:0,trendsId:0,refCustomerId:0}},collectionCancel:{desc:"取消收藏 paramJson",url:DYNAMIC_CALL+"collection/delete/",params:{dataFlag:2,refId:0,trendsId:0,refCustomerId:0}},reviewDelete:{desc:"删除评论 paramJson",url:DYNAMIC_CALL+"review/delete/",params:{id:0,trendsId:0}},docDelete:{desc:"删除文库",url:DYNAMIC_CALL+"customer/doc/delete/",params:{docId:0}},videoDelete:{desc:"删除视频",url:DYNAMIC_CALL+"customer/video/delete/",params:{videoId:0}},caseDelete:{desc:"删除病例",url:DYNAMIC_CALL+"case_baseinfo/delete/",params:{caseId:0}},topicDelete:{desc:"删除话题",url:DYNAMIC_CALL+"topic/baseinfo/delete/",params:{topicId:0}}}},VNS_Helpers={pretreatmentFns_Sub:function(e,t){e?(e.options.callback=function(){t.main(t)},e.pointer(e.options)):t.main(t)},mouseEnterOut_Sub:function(e,t,r){if(t){if(e.hide(),!(r.length>0))throw new Error("需要的移入的元素设定不存在！");r.off("mouseenter").off("mouseleave").on("mouseenter",function(){e.show()}).on("mouseleave",function(){e.hide()})}}};!function($){$.fn.extend({VNS_SocialSuite:function(options){routine(API_Plugins._Open_SocialSuite);var $this=this,Velen={Services_Props_Name:"VNS_SocialSuite",Ele_Props_Events:"velen-social-suite",Ele_Props_EventsValueDesc:{reprint:{reprint:"转发默认状态",reprintAction:"转发激活状态"},prefer:{prefer:"赞默认状态",preferAction:"赞激活状态"},collection:{collection:"收藏默认状态",collectionAction:"收藏激活状态"},review:{review:"评论默认状态",reviewAction:"评论激活状态"},setFirst:{setFirst:"置顶默认状态",setFirstAction:"置顶激活状态"},share:{share:"分享默认状态",shareAction:"分享激活状态"},remove:{remove:"删除"}},Ele_Props_Total:"velen-social-suite-total",Ele_Props_State:"velen-social-suite-state"},cfg={Pretreatment_Fn:null,$UI_Obj_SuiteDefault:$(""),$UI_Obj_SuiteAction:$(""),ReprintCreateParams:{},ReprintCancelParams:{}},API_SA=API.socialAction,API_Url={API_Str_ReprintCreate:API_SA.reprintCreate.url,API_Str_ReprintCancel:API_SA.reprintCancel.url,API_Str_PreferCreate:API_SA.preferCreate.url,API_Str_PreferCancel:API_SA.preferCancel.url,API_Str_CollectionCreate:API_SA.collectionCreate.url,API_Str_CollectionCancel:API_SA.collectionCancel.url,API_Str_ReviewDelete:API_SA.reviewDelete.url,API_Str_ReviewRecover:API_SA.reviewRecover.url,API_Str_DocDelete:API_SA.docDelete.url,API_Str_DocRecover:API_SA.docRecover.url,API_Str_DocSetFirstCreate:API_SA.docSetFirstCreate.url,API_Str_DocSetFirstCancel:API_SA.docSetFirstCancel.url,API_Str_VideoDelete:API_SA.videoDelete.url,API_Str_VideoRecover:API_SA.videoRecover.url,API_Str_VideoSetFirstCreate:API_SA.videoSetFirstCreate.url,API_Str_VideoSetFirstCancel:API_SA.videoSetFirstCancel.url,API_Str_CaseDelete:API_SA.caseDelete.url,API_Str_CaseRecover:API_SA.caseRecover.url,API_Str_CaseSetFirstCreate:API_SA.caseSetFirstCreate.url,API_Str_CaseSetFirstCancel:API_SA.caseSetFirstCancel.url,API_Str_TopicDelete:API_SA.topicDelete.url,API_Str_TopicRecover:API_SA.topicRecover.url,API_Str_TopicSetFirstCreate:API_SA.topicSetFirstCreate.url,API_Str_TopicSetFirstCancel:API_SA.topicSetFirstCancel.url};$.extend(cfg,options);var handles={init:function(){var _this=this;$this.html(cfg.$UI_Obj_SuiteDefault).find("["+Velen.Ele_Props_Events+"]").on("click",function(){return!(cfg.Pretreatment_Fn&&!eval(cfg.Pretreatment_Fn.name)(cfg.Pretreatment_Fn.params))&&(cfg.$UI_Obj_Context=$(this),void _this.exec[cfg.$UI_Obj_Context.attr(Velen.Ele_Props_Events)]())})},exec:{reprint:function(){},prefer:function(){handles.helpers.actionToggleProcess()},collection:function(){handles.helpers.actionToggleProcess()},review:function(){},setFirst:function(){},share:function(){},remove:function(){},recover:function(){}},helpers:{getTotal_Num:function(){return parseInt(cfg.$UI_Obj_Context.find("["+Velen.Ele_Props_Total+"]").html().match(/\d+/)[0])},getIsExistTotal_Boo:function(){return 0!==cfg.$UI_Obj_Context.find("["+Velen.Ele_Props_Total+"]").length},ajaxSend:function(e,t){var r=this;r.eventMatchAPIProcess(r.firstUpperCaseProcess(e),t);$.extend(API.socialAction.followCreate.params,cfg.AJAX_Obj_CreateParams),params.paramJson=$.toJSON(API.socialAction.followCreate.params),Fns.ajax.async(cfg.API_Str_Create,params,cfg.Ajax_Callback)},firstUpperCaseProcess:function(e){return e.substr(0,1).toUpperCase()+e.substr(1)},eventMatchAPIProcess:function(e,t){return t?cfg["API_Str_"+e+"Create"]:cfg["API_Str_"+e+"Cancel"]},actionToggleProcess:function(){var e,t=this,r=(t.getIsExistTotal_Boo(),total_Num=t.getTotal_Num()),o=cfg.$UI_Obj_Context.find("["+Velen.Ele_Props_Total+"]"),a=cfg.$UI_Obj_Context.attr(Velen.Ele_Props_State);a?(e=null,r--):(e=!0,r++),o.html(o.html().replace(total_Num,r)),cfg.$UI_Obj_Context.attr(Velen.Ele_Props_State,e),t.ajaxSend(cfg.$UI_Obj_Context.attr(Velen.Ele_Props_Events),e)}}};return handles.init(),$this}})}(jQuery),function(e){e.fn.extend({VNS_SocialDelete:function(t){if(VNS_Routine(VN_Services._Open_SocialDelete),t.Oper_Boo_Delete===!1)return!1;var r=this,o={Action_Type:1,AJAX_Obj_Params:{},Oper_Boo_Delete:!0,Oper_Boo_Mouse:{state:!1,ele:{}},AJAX_Obj_Callback:{success:null,error:null},$UI_Obj:{}},a={refType:"1_video|2_doc|4_topic|7_case|8_review",API_Obj_ReviewDelete:API.socialAction.reviewDelete,API_Obj_DocDelete:API.socialAction.docDelete,API_Obj_VideoDelete:API.socialAction.videoDelete,API_Obj_CaseDelete:API.socialAction.caseDelete,API_Obj_TopicDelete:API.socialAction.topicDelete};e.isEmptyObject(t.$UI_Obj)&&void 0!==t.$UI_Obj&&(t.$UI_Obj=r.clone()),e.extend(o,t);var n={init:function(){this.render(),VNS_Helpers.mouseEnterOut_Sub(r,o.Oper_Boo_Mouse.state,o.Oper_Boo_Mouse.ele)},render:function(){var e=this;r.html(o.$UI_Obj).on("click",function(){if($("body").find(".ev-delTips").length==0){var desc='评论';if($(this).hasClass('al-contentDelete'))desc='资源';$("body").append(module.list2Template.deleteTips(desc));$("body").find(".ev-delTips").show()}else{$("body").find(".ev-delTips").show()}$(".ev-delTips .ev-delSure").off("click").on("click",function(){Fns.ajax.async(e.helpers.ajaxCfg_Obj());$(".ev-delTips").hide()});$(".ev-delTips .ev-delCancel").on("click",function(){$(".ev-delTips").hide()})})},helpers:{ajaxCfg_Obj:function(){var t={};switch(o.Action_Type){case 1:t.url=a.API_Obj_VideoDelete.url,t.params=e.extend(a.API_Obj_VideoDelete.params,o.AJAX_Obj_Params);break;case 2:t.url=a.API_Obj_DocDelete.url,t.params=e.extend(a.API_Obj_DocDelete.params,o.AJAX_Obj_Params);break;case 4:t.url=a.API_Obj_TopicDelete.url,t.params=e.extend(a.API_Obj_TopicDelete.params,o.AJAX_Obj_Params);break;case 7:t.url=a.API_Obj_CaseDelete.url,t.params=e.extend(a.API_Obj_CaseDelete.params,o.AJAX_Obj_Params);break;case 8:t.url=a.API_Obj_ReviewDelete.url,t.params={},t.params.paramJson=e.toJSON(e.extend(a.API_Obj_ReviewDelete.params,o.AJAX_Obj_Params))}return t.callback=o.AJAX_Obj_Callback,t}}};return n.init(),r}})}(jQuery),function(e){e.fn.extend({VNS_SocialDialog:function(t){var r=this,o={};e.isEmptyObject(t.$UI_Obj)&&void 0!==t.$UI_Obj&&(t.$UI_Obj=r.clone()),e.extend(o,t);var a={init:function(){},render:function(){}};return a.init(),r}})}(jQuery),function(e){e.fn.extend({VNS_SocialFollow:function(t){VNS_Routine(VN_Services._Open_SocialFollow);var r=this,o={Action_Type:"personal",PretreatmentFns_Obj:null,Param_Num_State:1,Oper_Boo_Cancel:!0,Oper_Boo_Mouse:{state:!1,ele:{}},Ele_Props_Add:"vns-social-follow-add",Ele_Props_Already:"vns-social-follow-already",Ele_Props_Mutuality:"vns-social-follow-mutuality",Ele_Props_Cancel:"vns-social-follow-cancel",AJAX_Obj_Params:{create:{},cancel:{}},AJAX_Obj_Callback:{create:{success:null,error:null},cancel:{success:null,error:null}},$UI_Obj:e('<div><div vns-social-follow-add style="cursor:pointer;"><img src="/js/plugins/follow/image/add_86.png"></div><div vns-social-follow-already style="cursor:pointer;"><img src="/js/plugins/follow/image/ygz_86.png"></div><div vns-social-follow-mutuality style="cursor:pointer;"><img src="/js/plugins/follow/image/xh_86.png"></div><div vns-social-follow-cancel style="cursor:pointer;"><img src="/js/plugins/follow/image/qx_86.png"></div></div>')},a={Action_Type:"personal|resource",Services_Props_Name:"VNS_SocialFollow",API_Obj_Create:API.socialAction.followCreate,API_Obj_Cancel:API.socialAction.followCancel,API_Obj_ResourceCreate:API.socialAction.followResourceCreate,API_Obj_ResourceCancel:API.socialAction.followResourceCancel,Ele_Props_State:"vns-social-follow-state"};e.isEmptyObject(t.$UI_Obj)&&void 0!==t.$UI_Obj&&(t.$UI_Obj=r.clone()),e.extend(o,t);var n={init:function(){this.render(),VNS_Helpers.mouseEnterOut_Sub(r,o.Oper_Boo_Mouse.state,o.Oper_Boo_Mouse.ele)},render:function(){var t=this;switch(parseInt(o.Param_Num_State)){case 3:case 1:t.checkUIPropsAndShow_Sub(o.Ele_Props_Add);break;case 2:t.checkUIPropsAndShow_Sub(o.Ele_Props_Already);break;case 4:t.checkUIPropsAndShow_Sub(o.Ele_Props_Mutuality)}r.html(o.$UI_Obj.attr(a.Ele_Props_State,o.Param_Num_State)).off("click").on("click",function(){VNS_Helpers.pretreatmentFns_Sub(o.PretreatmentFns_Obj,t)}).off("mouseenter").off("mouseleave").on("mouseenter",function(){return!!o.Oper_Boo_Cancel&&void t.mouseToggleStyle_Sub(e(this),1)}).on("mouseleave",function(){return!!o.Oper_Boo_Cancel&&void t.mouseToggleStyle_Sub(e(this),0)})},main:function(e){var t=e.getState_Num();if(!o.Oper_Boo_Cancel&&(2===t||4===t))return!1;var r="create";switch(t){case 1:o.Param_Num_State=2;break;case 2:o.Param_Num_State=1,r="cancel";break;case 3:o.Param_Num_State=4;break;case 4:o.Param_Num_State=3,r="cancel"}e.ajaxSend_Sub(r),e.render()},
    checkUIPropsAndShow_Sub:function(e){
        //try{if(e!==o.Ele_Props_Cancel&&0===o.$UI_Obj.find("["+e+"]").length)
        //    throw new Error("UI标签定义错误！缺少对应的"+e+"属性");
        //    o.$UI_Obj.find("["+e+"]").show().siblings().hide()}
        //catch(t){
        //    throw new Error("UI标签定义错误！缺少对应的"+e+"属性")
        //}
    },mouseToggleStyle_Sub:function(e,t){var r=this,a=r.getState_Num();2!==a&&4!==a||1!==t?2!==a&&4!==a||0!==t||(2===a&&r.checkUIPropsAndShow_Sub(o.Ele_Props_Already),4===a&&r.checkUIPropsAndShow_Sub(o.Ele_Props_Mutuality)):r.checkUIPropsAndShow_Sub(o.Ele_Props_Cancel)},getState_Num:function(){return parseInt(r.find("["+a.Ele_Props_State+"]").attr(a.Ele_Props_State))},ajaxSend_Sub:function(t){var r=this.getAPI_Obj(t);e.extend(r.params,o.AJAX_Obj_Params.create);var a={paramJson:e.toJSON(r.params)};Fns.ajax.async(r.url,a,o.AJAX_Obj_Callback[t])},getAPI_Obj:function(e){var t={};switch(o.Action_Type){case"resource":t="create"===e?a.API_Obj_ResourceCreate:a.API_Obj_ResourceCancel;break;case"personal":default:t="create"===e?a.API_Obj_Create:a.API_Obj_Cancel}return t}};return n.init(),r}})}(jQuery),function($){$.fn.extend({VNS_SocialToggle:function(options){VNS_Routine(VN_Services._Open_SocialToggle);var $this=this,cfg={Action_Type:"prefer",Action_State:0,PretreatmentFns_Obj:null,$UI_Obj:null,Ele_Props_Total:"vns-social-toggle-total",Ele_Props_default:"vns-social-toggle-default",Ele_Props_Activation:"vns-social-toggle-activation",Oper_Boo_Cancel:!0,Oper_Boo_Mouse:{state:!1,ele:{}},AJAX_Obj_Params:{create:{},cancel:{}},AJAX_Obj_Callback:{create:{success:null,error:null},cancel:{success:null,error:null}}},Velen={Services_Props_Name:"VNS_SocialToggle",Action_Type:"prefer|collection",Ele_Props_Type:"vns-social-toggle-type",Ele_Props_State:"vns-social-toggle-state",API_Obj_PreferCreate:API.socialAction.preferCreate,API_Obj_PreferCancel:API.socialAction.preferCancel,API_Obj_CollectionCreate:API.socialAction.collectionCreate,API_Obj_CollectionCancel:API.socialAction.collectionCancel};$.isEmptyObject(options.$UI_Obj)&&void 0!==options.$UI_Obj&&(options.$UI_Obj=$this.clone()),$.extend(cfg,options);var handles={init:function(){this.render(),VNS_Helpers.mouseEnterOut_Sub($this,cfg.Oper_Boo_Mouse.state,cfg.Oper_Boo_Mouse.ele)},render:function(){var _this=this;_this.exec.helpers.initUIPropsAndShow_Sub(),$this.html(cfg.$UI_Obj.attr(Velen.Ele_Props_Type,cfg.Action_Type).attr(Velen.Ele_Props_State,cfg.Action_State)).on("click",function(){var $this=$(this);user.login({callback:function(){return!(cfg.PretreatmentFns_Obj&&!eval(cfg.PretreatmentFns_Obj.name)(cfg.PretreatmentFns_Obj.params))&&(!(!cfg.Oper_Boo_Cancel&&cfg.Action_State)&&(cfg.$UI_Obj_Context=$this,void _this.exec[$this.children().attr(Velen.Ele_Props_Type)]($this)))},scene:privilegeSceneConst.eSceneTypePraiseResourse})})},exec:{prefer:function(){this.toggleComm_Sub()},collection:function(){this.toggleComm_Sub()},toggleComm_Sub:function(){var e=this,t=cfg.Action_State;t?(cfg.Action_State=0,e.helpers.initUIPropsAndShow_Sub(),e.helpers.handlerTotal_Sub(t)):(cfg.Action_State=1,e.helpers.initUIPropsAndShow_Sub(),e.helpers.handlerTotal_Sub(t)),cfg.$UI_Obj_Context.attr(Velen.Ele_Props_State,cfg.Action_State),Fns.ajax.async(e.helpers.ajaxCfg_Obj(t))},helpers:{_getTotal_Num:function(){return parseInt(cfg.$UI_Obj_Context.find("["+cfg.Ele_Props_Total+"]").html().match(/\d+/)[0])},_getIsExistTotal_Boo:function(){return 0!==cfg.$UI_Obj_Context.find("["+cfg.Ele_Props_Total+"]").length},handlerTotal_Sub:function(e){var t=this;if(t._getIsExistTotal_Boo()){var r=total_Num=t._getTotal_Num();e?r>0?r--:0:r++;var o=cfg.$UI_Obj_Context.find("["+cfg.Ele_Props_Total+"]");o.html(o.html().replace(total_Num,r))}},initUIPropsAndShow_Sub:function(){cfg.$UI_Obj.children().hide(),cfg.Action_State?cfg.$UI_Obj.find("["+cfg.Ele_Props_Activation+"]").show():cfg.$UI_Obj.find("["+cfg.Ele_Props_default+"]").show()},ajaxCfg_Obj:function(e){var t={};t.params={};var r=Fns.word.firstUpperCase(cfg.$UI_Obj_Context.children().attr(Velen.Ele_Props_Type));return e?(t.url=Velen["API_Obj_"+r+"Cancel"].url,t.params.paramJson=$.toJSON($.extend(Velen["API_Obj_"+r+"Cancel"].params,cfg.AJAX_Obj_Params.cancel)),t.callback=cfg.AJAX_Obj_Callback.cancel):(t.url=Velen["API_Obj_"+r+"Create"].url,t.params.paramJson=$.toJSON($.extend(Velen["API_Obj_"+r+"Create"].params,cfg.AJAX_Obj_Params.create)),t.callback=cfg.AJAX_Obj_Callback.create),t}}}};return handles.init(),$this}})}(jQuery);