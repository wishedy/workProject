!function(e){try{var t=e.debugLog||function(){var e=localStorage&&localStorage.getItem&&localStorage.getItem("g_debugMode");if("undefined"!=typeof e&&e&&null!=typeof e&&void 0!=console.group){arguments.length>1&&console.group("group");for(var t=0;t<arguments.length;t++)"object"==typeof arguments[t]?console.dir(arguments[t]):console.log(arguments[t]);arguments.length>1&&console.groupEnd()}},n=function(){};n.prototype={init:function(n){var o=this.getData();if(!n.token)return void t("token值为空");this.store.baseData=this.util.deepExtend({},o,n),this.config=this.util.deepExtend({},this.config,n),this.initWindowErrorHandle(e,this.store),this.initClickHandle(e,this.store),this.checkImg(this.store);var r=this;setTimeout(function(){r.util.checkClientSpeed(function(e){e&&(r.store.baseData.clintSpeed=e)})},3e3)},util:function(){function e(e,n,r){if(t("send Data------"),t(e),"XDomainRequest"in window&&null!==window.XDomainRequest){var i=new XDomainRequest;i.open("get",n+"?"+o(e)),i.onload=function(){"function"==typeof r&&r.call(this,i.responseText)},i.onerror=function(){console.log("ajaxError")},i.send()}else{var a=JSON.stringify(e),s=new XMLHttpRequest;s.open("POST",n,!0),s.setRequestHeader("Content-type","application/json;charset=UTF-8"),s.onreadystatechange=function(){4!==s.readyState||200!==s.status&&304!==s.status||"function"==typeof r&&r.call(this,s.responseText)},s.send(a)}}function n(e,t){return"undefined"==typeof t?e:e+"="+encodeURIComponent(null===t?"":String(t))}function o(e){var t=[];for(var o in e){o=encodeURIComponent(o);var r=e[o];if(r&&r.constructor==Array){for(var i,a=[],s=0,c=r.length;s<c;s++)i=r[s],a.push(n(o,i));t=t.concat(a)}else t.push(n(o,r))}return t.join("&")}function r(e){e=e||{};for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var o in n)n.hasOwnProperty(o)&&("object"==typeof n[o]?e[o]=r(e[o],n[o]):e[o]=n[o])}return e}function i(){try{return localStorage.setItem("aa","bb"),null!==localStorage.getItem("aa")}catch(e){return!1}}function a(e){if(document.cookie.length>0){var t=document.cookie.indexOf(e+"=");if(t!=-1){t+=e.length+1;var n=document.cookie.indexOf(";",t);return n==-1&&(n=document.cookie.length),document.cookie.substring(t,n)}}return null}function s(e){var t=1.1,n="./allin_log.png?"+(new Date).getTime(),o=document.createElement("img");if(o.setAttribute("src",n),o.setAttribute("style","display:none"),!document.body)return!1;document.body.appendChild(o);var r=(new Date).getTime();o.onload=function(){var n=(new Date).getTime()-r,o="";!isNaN(n)&&n>0&&(o=Math.round(1e3*t/n)),e(o)}}return{deepExtend:r,postData:e,getCookie:a,canSupportLocalStorage:i,checkClientSpeed:s}}(),store:{logList:[],resourceListLength:0,breadcrumbs:[]},config:{reportVersion:"1.1.0",reportPath:"//arthas.allinmd.cn/ams/catch",limitTime:3e3,sourceIgnore:["/ams/catch"],checkImgSetIntervalTime:1e4,transferSizeNum:1024},getData:function(){function e(){var e=[];return"undefined"!=typeof jQuery&&jQuery&&jQuery.fn.jquery&&e.push("jQuery_"+jQuery.fn.jquery),"undefined"!=typeof Vue&&Vue&&Vue.version&&e.push("Vue_"+Vue.version),"undefined"!=typeof React&&React&&React.version&&e.push("React_"+React.version),e.length>0?e:""}function t(){var e;return o.util.canSupportLocalStorage()?null!==localStorage.getItem("userId")&&(e=localStorage.getItem("userId")):null!==o.util.getCookie("userId")&&(e=getCookie("userId")),e}function n(){var e=0,t=0,n=!-[1];if(n){var o=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");o&&(e=1,t=o.GetVariable("$version"))}else if(navigator.plugins&&navigator.plugins.length>0){var o=navigator.plugins["Shockwave Flash"];o&&(e=1,t=o.description)}return 1==e?t:""}var o=this,r={userAgent:navigator.userAgent,currentUrl:window.location.href,host:window.location.host,timestamp:(new Date).getTime(),projectType:/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?"Mobile":"PC",flashVer:n(),title:document.title,screenSizeVw:document.documentElement?document.documentElement.clientWidth:document.body.clientWidth,screenSizeVh:document.documentElement?document.documentElement.clientHeight:document.body.clientHeight,referer:document.referrer,colNum:0,rowNum:0,msg:"",level:1,targetUrl:"",userId:t(),appVersion:e(),reportVersion:o.config.reportVersion,token:""};return r},checkImg:function(){var e=this;t("再次执行检查图片");var n=function(){var e=window.performance||window.webkitPerformance||window.msPerformance||window.mozPerformance;return void 0!==e&&void 0!=e.timing&&void 0!=e.now&&e}();if(!n)return!1;if(!n.getEntriesByType)return!1;var o=e.config.sourceIgnore;setInterval(function(){if(t("开始执行检查图片----"),e.store.resourceListLength<n.getEntriesByType("resource").length){var r=window.performance.getEntriesByType("resource").slice(e.store.resourceListLength);if(r.forEach(function(n,i){for(var a=0;a<o.length;a++)n.name.indexOf(o[a])!==-1&&(r.splice(i),t("有新增的资源被排除,sourceIgnore: name为:"),t(n.name),t("sourceIgnore了通过performance.getEntriesByType(resource)的ID为:"+(e.store.resourceListLength+i)))}),r.length>0){var i=[],a="";r.map(function(n,o){"img"===n.initiatorType&&n.transferSize>1024*e.config.transferSizeNum&&(t("有图片的大小大于指定大小"+n.name+"--"+n.transferSize),i.push(n.name),a+=n.name+"|"+n.transferSize+";")}),i&&i.length>0&&(t("需要发送的imgList:",i),t("需要发送的imgNameList:",a),e.checkBeforeSend(e.util.deepExtend({},e.store.baseData,{bigIMgList:a,msg:"images is too big!"}),e.store))}e.store.resourceListLength=window.performance.getEntriesByType("resource").length,t("totalResourceLength:"+e.store.resourceListLength)}},e.config.checkImgSetIntervalTime)},checkBeforeSend:function(e){var n=!1,o=!1,r=this.store,i=this.config;if(e)if(r.logList&&r.logList.length){for(var a=0;a<r.logList.length;a++)if(e.msg&&r.logList[a].msg&&e.msg===r.logList[a].msg&&(o=!0,Math.abs(e.timestamp-r.logList[a].timestamp)>=i.limitTime)){r.logList[a].timestamp=e.timestamp,n=!0,o=!1;break}n||o||(r.logList&&r.logList.push(e),n=!0)}else r.logList=[],r.logList.push(e),n=!0;n&&(e.breadcrumbs=r.breadcrumbs,this.sendData(e,i.reportPath)),t("checkBeforeSend_logList",r.logList)},sendData:function(e,t){var n=this;setTimeout(function(){n.util.postData(e,t)},0)},initWindowErrorHandle:function(e,n){if(e){var o=this;e.onerror=function(r,i,a,s,c){if(t("触发window.onerror事件"),t(r),"Script error."!=r&&!i)return!0;var u={};s=s||e.event&&e.event.errorCharacter||0,u.targetUrl=i,u.rowNum=a,u.colNum=s,u.msg=r,c&&c.stack&&(u.msg=c.stack.toString()),o.checkBeforeSend(o.util.deepExtend({},n.baseData,u))}}},initClickHandle:function(e,t){function n(e){var t=e.target?e.target:e.srcElement,n=t&&t.outerHTML;n&&n.length>200&&(n=n.slice(0,200));var r={outerHTML:n,tagName:t&&t.tagName,id:t&&t.id,className:t&&t.className,name:t&&t.name,time:(new Date).getTime()};o.store.breadcrumbs.length>=20&&o.store.breadcrumbs.shift(),o.store.breadcrumbs.push(r)}var o=this;e.addEventListener?e.addEventListener("click",n,!0):document.attachEvent("onclick",n)},initVueErrorHandle:function(e,t){function n(e,t){if(!e)return null;var n=e.toString().split("\n"),o=n.length;return o>t?n.slice(0,t).join("\n"):e}this.checkBeforeSend(this.util.deepExtend({},this.store.baseData,t,{msg:n(e.stack,10)}))}},"undefined"!=typeof module&&module.exports&&(module.exports=new n),"function"==typeof define&&define(function(){return new n}),e.arthas_monitor=new n}catch(o){}}("undefined"!=typeof window?window:this);